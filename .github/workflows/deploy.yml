name: Deploy to Pterodactyl
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Sync Files to Panel
        uses: rexlmanu/pterodactyl-upload-action@v2
        with:
          panel-host: ${{ secrets.PTERO_URL }}
          api-key: ${{ secrets.PTERO_API_KEY }}
          server-id: ${{ secrets.SERVER_ID }}
          source: "./"
          target: "/"
          # We exclude node_modules because the server's startup script
          # will run "npm install" automatically upon restart.
          exclude: "node_modules, .git, .github, auth_info_baileys, .env"

      - name: Trigger Server Restart
        uses: d3oxy/pterodactyl-power@V1
        with:
          PANEL_URL: ${{ secrets.PTERO_URL }}
          API_KEY: ${{ secrets.PTERO_API_KEY }}
          SERVER_ID: ${{ secrets.SERVER_ID }}
          POWER_ACTION: "restart"
